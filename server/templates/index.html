<!DOCTYPE html>
<!--suppress ALL -->
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Gaia</title>
        <link rel="stylesheet" type="text/css" href="public/css/sakura.css">
        <link rel="stylesheet" type="text/css" href="public/css/gaia.css">
        <script src="public/js/jquery-3.3.1.min.js"></script>
        <script src="public/js/Chart-2.7.2.min.js"></script>
        <link rel="icon" type="image/png" sizes="32x32" href="public/img/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="96x96" href="public/img/favicon-96x96.png">
        <link rel="icon" type="image/png" sizes="16x16" href="public/img/favicon-16x16.png">
    </head>
    <body>
        <img id="logo" src="public/img/gaia.jpg" alt="logo" width="100" height="97" />
        <h1>Gaia</h1>

        <div id="connectivity">
            <p>Connectivity: Ping={{TEST_PORT_SSH}} Video={{TEST_PORT_VIDEO}}</p>
            <p><a href="#" onclick="loadFeed()">Load live feed</a></p>
            <div id="live_feed"></div>
        </div>

        <div id="graph" style="display:none">
            <h3>Graph</h3>
            <div id="canvas-holder1" style="width:100%;">
                <canvas id="chart1"></canvas>
            </div>
        </div>

        {{CURRENT_CONFIG}}

        <div id="update_response">
            <h3>Update Config</h3>
            Pending config update: 
            <pre>{{NEXT_COMMAND}}</pre>
            <a href="#" id="update_config_link">(change)</a>

            <form id="formNewCommand" method="post" action="/command" style="display:none">
                <p>Add new command: <select id="newCommand"  name="newCommand" >
                  <option value="0">DO_NOTHING</option>
                  <option value="1">SHUTDOWN</option>
                  <option value="2">REBOOT</option>
                </select></p>
                <p>And update config: <select id="updateConfig"  name="updateConfig" >
                  <option value="0">No</option>
                  <option value="1">Yes</option>
                </select></p>

                <div id="divUpdateConfig" style="display:none">
                    <p>Feeding enabled: <select id="feedingEnabled"  name="feedingEnabled" >
                  <option value="0">No</option>
                  <option value="1">Yes</option>
                    </select></p>
                    <p>Watering enabled: <select id="wateringEnabled"  name="wateringEnabled" >
                  <option value="0">No</option>
                  <option value="1">Yes</option>
                    </select></p>
                    <p>Feeding CronString:
                <input id="feedingCron"  name="feedingCron" placeholder="12h *" type="text" /></p>
                    <p>Watering CronString:
                <input id="wateringCron"  name="wateringCron" placeholder="13h 0,2,3" type="text" /></p>
                    <p>Pump 1 duration:
                <input id="pump1Duration"  name="pump1Duration" placeholder="10" type="text" /></p>
                    <p>Pump 2 duration:
                <input id="pump2Duration"  name="pump2Duration" placeholder="10" type="text" /></p>
                    <p>Pump 3 duration:
                <input id="pump3Duration"  name="pump3Duration" placeholder="10" type="text" /></p>
                    <p>Pump 4 duration:
                <input id="pump4Duration"  name="pump4Duration" placeholder="10" type="text" /></p>
                </div>

                <input id="passphrase"  name="passphrase" placeholder="Passphrase" type="password" />
                <input type="submit" value="Submit" />
            </form>
        </div>

        <div class="header">
            <h3><a href="#" id="status_link">Status</a> / <a href="#" id="reports_link">Reports</a></h3>
        </div>

        <div id="status">
            {{STATUS}}
        </div>
        <div id="reports" style="display:none">
            {{REPORTS}}
        </div>

    <script>
        function loadFeed(){
            const videoStream = '<img src="http://lbarman.ch:{{PORT_VIDEO}}/" alt="Video stream" class="shrinkToFit" width="632" height="474">'
            $('#live_feed').html(videoStream);
            return false;
        }

        function togglePanel(showPanel) {
            //$('#summary').css('display', 'none')
            $('#status').css('display', 'none')
            $('#reports').css('display', 'none')
            $('#'+showPanel).css('display', 'block')
        }

        $('#status_link').on('click', function(){
            togglePanel('status')
            return false;
        });
        $('#reports_link').on('click', function(){
            togglePanel('reports')
            return false;
        });

        $('#update_config_link').on('click', function(){
            $('#formNewCommand').css('display', 'block')
            $('#update_config_link').css('display', 'none')
            return false;
        })

        $('#updateConfig').on('change', function(){
            if(this.value == '1') {
                $('#divUpdateConfig').css('display', 'block')
            } else {
                $('#divUpdateConfig').css('display', 'none')
            }
        })

        $("#formNewCommand").submit(function(e) {
            var form = $(this);
            var url = form.attr('action');
            $.ajax({
                   type: "POST",
                   url: url,
                   data: form.serialize(),
                   success: function(data)
                   {
                       console.log(data);
                   },
                   error: function (request, error) {
                        console.log(arguments);
                   alert(" Can't do because: " + error);
                   },
            });
            e.preventDefault();
        });
    </script>
    </body>
</html>